{% extends "base.html" %}

{% block main %}
<main class="main">
    <div class="main_content">
        <h1>Document-Topic Distributions</h1>
        <p>Each document consists to a certain extent of each topic, which is one of the theoretical assumptions of
            topic models. Visualizing those proportions in a heatmap displays the kind of information that is probably
            most useful to literary scholars. Going beyond pure exploration, it can be used to show thematic
            developments over a set of texts as well as a single text, akin to a dynamic topic model.</p>
        </p>
        <p id="document-topic-heatmap"></p>
    </div>
    <script>
        function formatData(data) {
            var series = [];
            for (var document in data) {
                var values = {
                    name: document,
                    data: []
                };
                for (var topic in data[document]) {
                    values['data'].push({
                        x: topic,
                        y: data[document][topic]
                    });
                }
                series.push(values);
            }
            return series;
        }

        function getHeight(rows) {
            if (rows.length < 20) {
                return 600;
            } else {
                return 20 * rows.length;
            }
        };

        function plotDocumentTopicHeatmap() {
            // Get data from API endpoint
            $.getJSON("{{ url_for('get_document_topic_distributions') }}", function (data) {
                const series = formatData(data);
                const height = getHeight(series);
                console.log(height)
                const options = {
                    chart: {
                        toolbar: {
                            show: true,
                            tools: {
                                download: true,
                            }
                        },
                        type: 'heatmap',
                        height: height,
                    },
                    dataLabels: {
                        enabled: false
                    },
                    colors: ['#213365'],
                    series: series,
                    tooltip: {
                        x: {
                            show: true
                        }
                    },
                    xaxis: {
                        tooltip: {
                            enabled: false,
                        }
                    }
                };

                // Get element
                const chart = new ApexCharts(
                    document.querySelector('#document-topic-heatmap'),
                    options
                );

                // Render plot
                chart.render();
            });
        };

        // Call the function to plot heatmap
        plotDocumentTopicHeatmap()
    </script>
</main>
{% endblock %}